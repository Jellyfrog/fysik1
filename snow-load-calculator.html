<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snolastberaknare - SS-EN 1991-1-3</title>
    <link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>‚ùÑÔ∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Pacifico&family=Inter:wght@400;500;600&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style id="theme-styles"></style>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { min-height: 100vh; padding: 20px; transition: background 0.5s ease, color 0.5s ease; overflow-x: hidden; }
        .container { max-width: 1400px; margin: 0 auto; position: relative; z-index: 1; }
        .back-link { display: inline-block; margin-bottom: 15px; text-decoration: none; font-weight: 600; }
        .back-link:hover { text-decoration: underline; }
        .theme-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .theme-btn { padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; display: flex; align-items: center; gap: 6px; }
        .main-content { display: grid; grid-template-columns: 380px 1fr; gap: 30px; }
        @media (max-width: 900px) { .main-content { grid-template-columns: 1fr; } }
        .control-group { margin-bottom: 20px; }
        .control-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .input-group { display: flex; align-items: center; gap: 10px; }
        .input-group input[type="number"] { width: 80px; padding: 10px; font-size: 1em; text-align: right; font-weight: 600; }
        .input-group .unit-label { font-size: 0.9em; min-width: 50px; }
        input[type="range"] { flex: 1; height: 10px; border-radius: 10px; outline: none; -webkit-appearance: none; }
        .canvas-container { display: flex; flex-direction: column; gap: 20px; }
        canvas { border-radius: 20px; width: 100%; }
        .result-row { display: flex; justify-content: space-between; padding: 8px 0; }
        .preset-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .section-divider { height: 2px; margin: 20px 0; }
        .radio-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .radio-group label { display: flex; align-items: center; gap: 6px; cursor: pointer; padding: 8px 14px; border-radius: 10px; font-weight: 500; transition: all 0.3s; }
        .radio-group input { display: none; }
        .decoration { position: fixed; pointer-events: none; animation: float 3s ease-in-out infinite; z-index: 0; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; } 50% { transform: translateY(-20px) rotate(180deg); opacity: 1; } }
        @keyframes catBounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-15px) rotate(5deg); } }
        .cat-decoration { animation: catBounce 2s ease-in-out infinite; }
        .comparison-chart { height: 200px; display: flex; align-items: flex-end; justify-content: center; gap: 40px; padding: 20px; border-radius: 20px; margin-top: 20px; }
        .bar-container { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .bar { width: 50px; border-radius: 25px 25px 10px 10px; transition: height 0.5s ease; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link" id="backLink">‚Üê Tillbaka</a>
        <div class="theme-selector">
            <button class="theme-btn" data-theme="serious" onclick="setTheme('serious')"><span>üìê</span> Serios</button>
            <button class="theme-btn" data-theme="princess" onclick="setTheme('princess')"><span>üëë</span> Prinsessa</button>
            <button class="theme-btn" data-theme="cats" onclick="setTheme('cats')"><span>üê±</span> Katter</button>
        </div>
        <h1 id="main-title">Snolastberaknare</h1>
        <p class="subtitle">Berakna snolast pa tak enligt SS-EN 1991-1-3</p>

        <div class="main-content">
            <div class="controls">
                <div class="example-note">
                    <strong>Formel:</strong> s = Œº<sub>i</sub> ¬∑ C<sub>e</sub> ¬∑ C<sub>t</sub> ¬∑ s<sub>k</sub><br>
                    s<sub>k</sub> = karakteristiskt varde for snolast pa mark<br>
                    Œº<sub>i</sub> = formfaktor (beror pa takvinkel och taktyp)<br>
                    C<sub>t</sub> = termisk koefficient (normalt 1,0)<br>
                    C<sub>e</sub> = exponeringsfaktor
                </div>

                <div class="section-header"><h3>Taktyp</h3></div>
                <div class="preset-buttons">
                    <button class="preset-btn active" id="presetPulpet">Pulpettak</button>
                    <button class="preset-btn" id="presetSadel">Sadeltak</button>
                </div>

                <div class="section-divider"></div>
                <div class="section-header"><h3>Parametrar</h3></div>

                <div class="control-group">
                    <label>Takvinkel (Œ±) <span class="unit">[¬∞]</span></label>
                    <div class="input-group">
                        <input type="number" id="roofAngle" min="0" max="60" step="1" value="20">
                        <span class="unit-label">¬∞</span>
                        <input type="range" id="roofAngleSlider" min="0" max="60" step="1" value="20">
                    </div>
                </div>

                <div class="control-group">
                    <label>Snolast pa mark (s<sub>k</sub>) <span class="unit">[kN/m¬≤]</span></label>
                    <div class="input-group">
                        <input type="number" id="snowGround" min="0.5" max="6" step="0.1" value="2.5">
                        <span class="unit-label">kN/m¬≤</span>
                        <input type="range" id="snowGroundSlider" min="0.5" max="6" step="0.1" value="2.5">
                    </div>
                </div>

                <div class="control-group">
                    <label>Topografi (C<sub>e</sub>)</label>
                    <div class="radio-group" id="topoGroup">
                        <label class="radio-label"><input type="radio" name="topo" value="1.0" checked> Vindutsatt (1,0)</label>
                        <label class="radio-label"><input type="radio" name="topo" value="1.0n"> Normal (1,0)</label>
                        <label class="radio-label"><input type="radio" name="topo" value="1.2"> Skyddad (1,2)</label>
                    </div>
                </div>

                <div class="control-group">
                    <label>Termisk koefficient (C<sub>t</sub>)</label>
                    <div class="input-group">
                        <input type="number" id="ctValue" min="0.5" max="1.5" step="0.1" value="1.0">
                        <span class="unit-label">(normalt 1,0)</span>
                    </div>
                </div>

                <div class="control-group" id="roofLengthGroup">
                    <label>Taklangd <span class="unit">[m]</span></label>
                    <div class="input-group">
                        <input type="number" id="roofLength" min="2" max="30" step="0.5" value="8">
                        <span class="unit-label">m</span>
                        <input type="range" id="roofLengthSlider" min="2" max="30" step="0.5" value="8">
                    </div>
                </div>

                <div class="results">
                    <h3>Resultat</h3>
                    <div class="result-row">
                        <span class="result-label">Œº<sub>1</sub> (formfaktor):</span>
                        <span class="result-value" id="mu1Value">0.800</span>
                    </div>
                    <div class="result-row" id="mu2Row" style="display:none;">
                        <span class="result-label">Œº<sub>2</sub> (sadeltak):</span>
                        <span class="result-value" id="mu2Value">0.800</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">C<sub>e</sub>:</span>
                        <span class="result-value" id="ceDisplay">1.000</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">C<sub>t</sub>:</span>
                        <span class="result-value" id="ctDisplay">1.000</span>
                    </div>
                    <div class="result-row total-row">
                        <span class="result-label">s (snolast pa tak):</span>
                        <span class="result-value total" id="snowResult">2.000 kN/m¬≤</span>
                    </div>

                    <div class="formula-box" id="formulaBox"></div>
                </div>
            </div>

            <div class="visualization">
                <div class="canvas-container">
                    <canvas id="roofCanvas" width="800" height="350"></canvas>
                    <canvas id="chartCanvas" width="800" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const themes = {
            serious: {
                name: 'Serios', decorations: [],
                colors: {
                    roof: '#8d6e63', snow: '#bbdefb', snowDark: '#64b5f6', ground: '#795548',
                    text: '#e0e0e0', textMuted: '#9e9e9e', accent: '#4fc3f7', accentDark: '#0288d1',
                    total: '#81c784', canvasBg: '#0d1421', grid: 'rgba(255,255,255,0.06)',
                    sky: '#1a237e', wall: '#5d4037', arrowColor: '#ef5350', mu1Color: '#42a5f5', mu2Color: '#ab47bc'
                },
                css: `
                    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #e0e0e0; }
                    h1 { text-align: center; margin-bottom: 10px; color: #4fc3f7; font-weight: 600; font-size: 2em; }
                    .subtitle { text-align: center; color: #9e9e9e; margin-bottom: 30px; }
                    .back-link { color: #4fc3f7; }
                    .theme-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #aaa; }
                    .theme-btn:hover, .theme-btn.active { background: rgba(79,195,247,0.2); border-color: #4fc3f7; color: #4fc3f7; }
                    .controls, .visualization { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); }
                    .control-group label { color: #4fc3f7; }
                    .unit, .unit-label { color: #888; }
                    input[type="range"] { background: #333; }
                    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #4fc3f7; cursor: pointer; }
                    .input-group input[type="number"] { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-family: 'Inter', sans-serif; }
                    .input-group input[type="number"]:focus { outline: none; border-color: #4fc3f7; }
                    .results { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 20px; margin-top: 20px; }
                    .results h3, .section-header h3 { color: #4fc3f7; margin-bottom: 15px; border-bottom: 1px solid rgba(79,195,247,0.3); padding-bottom: 10px; }
                    .result-row { border-bottom: 1px solid rgba(255,255,255,0.05); }
                    .result-label { color: #aaa; } .result-value { color: #4fc3f7; font-weight: 700; font-family: monospace; }
                    .result-value.total { color: #81c784; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 2px solid rgba(79,195,247,0.3); }
                    .formula-box { background: rgba(79,195,247,0.1); border: 1px solid rgba(79,195,247,0.3); border-radius: 8px; padding: 15px; margin-top: 15px; font-family: monospace; font-size: 0.9em; line-height: 1.8; }
                    .formula-box .highlight { color: #81c784; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, rgba(79,195,247,0.3) 50%, transparent 100%); }
                    .example-note { background: rgba(79,195,247,0.1); border: 1px solid rgba(79,195,247,0.3); border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 0.85em; color: #4fc3f7; }
                    .example-note strong { color: #81c784; }
                    .preset-btn { padding: 10px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: #aaa; cursor: pointer; font-family: 'Inter', sans-serif; transition: all 0.3s; }
                    .preset-btn:hover { background: rgba(255,255,255,0.1); }
                    .preset-btn.active { background: rgba(79,195,247,0.2); border-color: #4fc3f7; color: #4fc3f7; }
                    canvas { background: #0d1421; border: 1px solid rgba(255,255,255,0.1); }
                    .radio-label { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #aaa; }
                    .radio-group input:checked + span, .radio-label:has(input:checked) { background: rgba(79,195,247,0.2); border-color: #4fc3f7; color: #4fc3f7; }
                `
            },
            princess: {
                name: 'Prinsessa', decorations: ['‚ú®', 'üíñ', '‚≠ê', 'üå∏', 'üíï', '‚ùÑÔ∏è'],
                colors: {
                    roof: '#c48a9f', snow: '#f3e5f5', snowDark: '#ce93d8', ground: '#a1887f',
                    text: '#5a4a6a', textMuted: '#9b7aa9', accent: '#d4699e', accentDark: '#c46a9e',
                    total: '#9b59b6', canvasBg: '#fff5fa', grid: 'rgba(200,100,160,0.08)',
                    sky: '#e8d5f9', wall: '#c48a9f', arrowColor: '#e91e8c', mu1Color: '#ab47bc', mu2Color: '#f06292'
                },
                css: `
                    body { font-family: 'Quicksand', sans-serif; background: linear-gradient(135deg, #ffeef8 0%, #f8e1f4 30%, #e8d5f9 70%, #dcd0ff 100%); color: #5a4a6a; }
                    h1 { text-align: center; margin-bottom: 10px; color: #d4699e; font-family: 'Pacifico', cursive; font-size: 2.5em; }
                    .subtitle { text-align: center; color: #9b7aa9; margin-bottom: 30px; }
                    .back-link { color: #d4699e; }
                    .theme-btn { background: linear-gradient(145deg, #fff 0%, #fff5fa 100%); border: 2px solid #f5c6e0; color: #b87a9e; }
                    .theme-btn:hover, .theme-btn.active { background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%); border-color: #d46a9e; color: #fff; }
                    .controls { background: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,240,250,0.9) 100%); border-radius: 25px; padding: 25px; border: 3px solid #f5c6e0; }
                    .visualization { background: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(248,240,255,0.9) 100%); border-radius: 25px; padding: 25px; border: 3px solid #e0c6f5; }
                    .control-group label { color: #c46a9e; }
                    .unit, .unit-label { color: #b89ac4; }
                    input[type="range"] { background: linear-gradient(90deg, #ffd6eb 0%, #e8c6f5 100%); }
                    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%); cursor: pointer; border: 3px solid #fff; }
                    .input-group input[type="number"] { background: #fff; border: 2px solid #f5c6e0; border-radius: 15px; color: #8b6a9e; font-family: 'Quicksand', sans-serif; }
                    .results { background: linear-gradient(145deg, #fff0f7 0%, #f8e8ff 100%); border-radius: 20px; padding: 20px; margin-top: 20px; border: 2px solid #f5d0e8; }
                    .results h3, .section-header h3 { color: #c46a9e; margin-bottom: 15px; border-bottom: 2px dashed #f5c6e0; padding-bottom: 10px; font-family: 'Pacifico', cursive; }
                    .result-row { border-bottom: 1px dashed #f0d6eb; }
                    .result-label { color: #9b7aa9; } .result-value { color: #c46a9e; font-weight: 700; }
                    .result-value.total { color: #9b59b6; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 2px dashed #e8b8d8; }
                    .formula-box { background: linear-gradient(145deg, #fff5fa 0%, #f0e8ff 100%); border: 2px dashed #dbb8e8; border-radius: 15px; padding: 15px; margin-top: 15px; font-size: 0.9em; line-height: 1.8; }
                    .formula-box .highlight { color: #9b59b6; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, #f5c6e0 50%, transparent 100%); }
                    .example-note { background: linear-gradient(145deg, #fff0f7 0%, #ffe8f5 100%); border: 2px dashed #f5a8c8; border-radius: 20px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; color: #b87a9e; }
                    .example-note strong { color: #d46a9e; }
                    .preset-btn { padding: 12px 20px; background: linear-gradient(145deg, #fff 0%, #fff5fa 100%); border: 2px solid #f5c6e0; border-radius: 25px; color: #b87a9e; cursor: pointer; font-family: 'Quicksand', sans-serif; font-weight: 600; transition: all 0.3s; }
                    .preset-btn.active { background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%); border-color: #d46a9e; color: #fff; }
                    canvas { background: linear-gradient(180deg, #fff5fa 0%, #f8f0ff 100%); border: 2px solid #f0d6eb; }
                    .radio-label { background: rgba(255,255,255,0.7); border: 2px solid #f5c6e0; color: #b87a9e; border-radius: 15px; }
                    .radio-label:has(input:checked) { background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%); color: #fff; }
                `
            },
            cats: {
                name: 'Katter', decorations: ['üê±', 'üêæ', 'üêü', 'üß∂', 'üò∫', '‚ùÑÔ∏è'],
                colors: {
                    roof: '#ff9966', snow: '#e3f2fd', snowDark: '#90caf9', ground: '#795548',
                    text: '#4a4a4a', textMuted: '#777', accent: '#ff7744', accentDark: '#e05500',
                    total: '#66bb6a', canvasBg: '#fffaf5', grid: 'rgba(255,120,70,0.06)',
                    sky: '#e3f2fd', wall: '#ff9966', arrowColor: '#e53935', mu1Color: '#42a5f5', mu2Color: '#ff7744'
                },
                css: `
                    body { font-family: 'Comic Neue', cursive; background: linear-gradient(135deg, #fff8f0 0%, #ffe8d6 100%); color: #4a4a4a; }
                    h1 { text-align: center; margin-bottom: 10px; color: #ff7744; font-size: 2.3em; font-weight: 700; }
                    h1::before { content: 'üò∫ '; } h1::after { content: ' üò∫'; }
                    .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
                    .back-link { color: #ff7744; }
                    .theme-btn { background: linear-gradient(145deg, #fff 0%, #fff8f0 100%); border: 2px solid #ffd4b8; color: #ff9966; }
                    .theme-btn:hover, .theme-btn.active { background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%); border-color: #ff7744; color: #fff; }
                    .controls { background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(255,248,240,0.95) 100%); border-radius: 25px; padding: 25px; border: 3px solid #ffd4b8; }
                    .visualization { background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(240,255,248,0.95) 100%); border-radius: 25px; padding: 25px; border: 3px solid #b8e0d2; }
                    .control-group label { color: #ff7744; font-weight: 700; }
                    .unit, .unit-label { color: #aaa; }
                    input[type="range"] { background: linear-gradient(90deg, #ffd4b8 0%, #b8e0d2 100%); }
                    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 28px; height: 28px; border-radius: 50%; background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%); cursor: pointer; border: 3px solid #fff; }
                    .input-group input[type="number"] { background: #fff; border: 2px solid #ffd4b8; border-radius: 15px; color: #666; font-family: 'Comic Neue', cursive; }
                    .results { background: linear-gradient(145deg, #fff8f0 0%, #f0fff8 100%); border-radius: 20px; padding: 20px; margin-top: 20px; border: 2px solid #ffd4b8; }
                    .results h3 { color: #ff7744; margin-bottom: 15px; border-bottom: 3px dotted #ffd4b8; padding-bottom: 10px; }
                    .results h3::before { content: 'üê± '; }
                    .section-header h3 { color: #ff7744; margin-bottom: 15px; }
                    .section-header h3::after { content: ' üêæ'; }
                    .result-row { border-bottom: 2px dotted #ffe8d6; }
                    .result-label { color: #888; } .result-value { color: #ff7744; font-weight: 700; }
                    .result-value.total { color: #66bb6a; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 3px dotted #b8e0d2; }
                    .formula-box { background: linear-gradient(145deg, #fff8f0 0%, #f0fff8 100%); border: 3px dotted #ffd4b8; border-radius: 15px; padding: 15px; margin-top: 15px; font-size: 0.9em; line-height: 1.8; }
                    .formula-box .highlight { color: #66bb6a; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, #ffd4b8 30%, #b8e0d2 70%, transparent 100%); }
                    .example-note { background: linear-gradient(145deg, #fff8f0 0%, #fffaf5 100%); border: 3px dotted #ffb088; border-radius: 20px; padding: 15px; margin-bottom: 20px; font-size: 0.85em; color: #888; }
                    .example-note strong { color: #ff7744; }
                    .preset-btn { padding: 12px 20px; background: linear-gradient(145deg, #fff 0%, #fff8f0 100%); border: 2px solid #ffd4b8; border-radius: 25px; color: #ff9966; cursor: pointer; font-family: 'Comic Neue', cursive; font-weight: 700; transition: all 0.3s; }
                    .preset-btn.active { background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%); border-color: #ff7744; color: #fff; }
                    canvas { background: linear-gradient(180deg, #fffaf5 0%, #f5fff8 100%); border: 3px solid #ffd4b8; }
                    .radio-label { background: rgba(255,255,255,0.8); border: 2px solid #ffd4b8; color: #ff9966; border-radius: 15px; }
                    .radio-label:has(input:checked) { background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%); color: #fff; }
                    .decoration { animation-name: catBounce; }
                `
            }
        };

        let currentTheme = 'serious';
        let colors = themes.serious.colors;
        let roofType = 'pulpet';

        function setTheme(themeName) {
            currentTheme = themeName;
            const theme = themes[themeName];
            colors = theme.colors;
            document.getElementById('theme-styles').textContent = theme.css;
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.theme === themeName));
            document.querySelectorAll('.decoration').forEach(el => el.remove());
            if (theme.decorations.length > 0) {
                for (let i = 0; i < 10; i++) {
                    const dec = document.createElement('div');
                    dec.className = 'decoration';
                    if (themeName === 'cats') dec.classList.add('cat-decoration');
                    dec.textContent = theme.decorations[Math.floor(Math.random() * theme.decorations.length)];
                    dec.style.left = Math.random() * 100 + 'vw';
                    dec.style.top = Math.random() * 100 + 'vh';
                    dec.style.animationDelay = Math.random() * 3 + 's';
                    dec.style.fontSize = (Math.random() * 15 + 12) + 'px';
                    document.body.appendChild(dec);
                }
            }
            localStorage.setItem('snowCalcTheme', themeName);
            update();
        }

        // Form factor table from PDF (BFS 2019:1)
        const muTable = {};
        const mu1Data = [[0,0.8],[15,0.8],[30,0.8],[31,0.77],[32,0.72],[33,0.72],[34,0.69],[35,0.67],[36,0.64],[37,0.61],[38,0.59],[39,0.56],[40,0.53],[41,0.51],[42,0.48],[43,0.45],[44,0.43],[45,0.40],[46,0.37],[47,0.35],[48,0.32],[49,0.29],[50,0.27],[51,0.24],[52,0.21],[53,0.19],[54,0.16],[55,0.13],[56,0.11],[57,0.08],[58,0.05],[59,0.03],[60,0.00]];

        function getMu1(alpha) {
            if (alpha <= 30) return 0.8;
            if (alpha >= 60) return 0.0;
            // Linear interpolation
            for (let i = 0; i < mu1Data.length - 1; i++) {
                if (alpha >= mu1Data[i][0] && alpha <= mu1Data[i+1][0]) {
                    const t = (alpha - mu1Data[i][0]) / (mu1Data[i+1][0] - mu1Data[i][0]);
                    return mu1Data[i][1] + t * (mu1Data[i+1][1] - mu1Data[i][1]);
                }
            }
            return 0.8;
        }

        function getMu2(alpha) {
            if (alpha <= 15) return 0.8;
            if (alpha >= 60) return 0.0;
            // mu2 for saddle roof: linear from 0.8 at 15¬∞ to 0 at 60¬∞
            return 0.8 * (60 - alpha) / (60 - 15);
        }

        const inputPairs = {
            roofAngle: { num: document.getElementById('roofAngle'), slider: document.getElementById('roofAngleSlider') },
            snowGround: { num: document.getElementById('snowGround'), slider: document.getElementById('snowGroundSlider') },
            roofLength: { num: document.getElementById('roofLength'), slider: document.getElementById('roofLengthSlider') }
        };

        Object.keys(inputPairs).forEach(key => {
            const pair = inputPairs[key];
            pair.num.addEventListener('input', () => { pair.slider.value = pair.num.value; update(); });
            pair.slider.addEventListener('input', () => { pair.num.value = pair.slider.value; update(); });
        });

        document.getElementById('ctValue').addEventListener('input', update);
        document.querySelectorAll('input[name="topo"]').forEach(r => r.addEventListener('change', update));

        document.getElementById('presetPulpet').addEventListener('click', () => {
            roofType = 'pulpet';
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('presetPulpet').classList.add('active');
            document.getElementById('mu2Row').style.display = 'none';
            update();
        });
        document.getElementById('presetSadel').addEventListener('click', () => {
            roofType = 'sadel';
            document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('presetSadel').classList.add('active');
            document.getElementById('mu2Row').style.display = '';
            update();
        });

        function getValues() {
            const alpha = parseFloat(inputPairs.roofAngle.num.value);
            const sk = parseFloat(inputPairs.snowGround.num.value);
            const ct = parseFloat(document.getElementById('ctValue').value);
            const topoRadio = document.querySelector('input[name="topo"]:checked');
            const ce = topoRadio.value === '1.0n' ? 1.0 : parseFloat(topoRadio.value);
            const roofLen = parseFloat(inputPairs.roofLength.num.value);
            return { alpha, sk, ct, ce, roofLen };
        }

        function update() {
            const v = getValues();
            const mu1 = getMu1(v.alpha);
            const mu2 = getMu2(v.alpha);
            const s1 = mu1 * v.ce * v.ct * v.sk;

            document.getElementById('mu1Value').textContent = mu1.toFixed(3);
            document.getElementById('mu2Value').textContent = mu2.toFixed(3);
            document.getElementById('ceDisplay').textContent = v.ce.toFixed(1);
            document.getElementById('ctDisplay').textContent = v.ct.toFixed(1);

            if (roofType === 'pulpet') {
                document.getElementById('snowResult').textContent = s1.toFixed(3) + ' kN/m¬≤';
                document.getElementById('formulaBox').innerHTML =
                    `s = Œº<sub>1</sub> ¬∑ C<sub>e</sub> ¬∑ C<sub>t</sub> ¬∑ s<sub>k</sub><br>` +
                    `s = ${mu1.toFixed(3)} ¬∑ ${v.ce.toFixed(1)} ¬∑ ${v.ct.toFixed(1)} ¬∑ ${v.sk.toFixed(1)}<br>` +
                    `<span class="highlight">s = ${s1.toFixed(3)} kN/m¬≤</span>`;
            } else {
                const s2 = mu2 * v.ce * v.ct * v.sk;
                document.getElementById('snowResult').textContent = s1.toFixed(3) + ' / ' + s2.toFixed(3) + ' kN/m¬≤';
                document.getElementById('formulaBox').innerHTML =
                    `Fall 1 (jamnt): s = Œº<sub>1</sub> ¬∑ C<sub>e</sub> ¬∑ C<sub>t</sub> ¬∑ s<sub>k</sub> = ${mu1.toFixed(3)} ¬∑ ${v.ce.toFixed(1)} ¬∑ ${v.ct.toFixed(1)} ¬∑ ${v.sk.toFixed(1)} = <span class="highlight">${s1.toFixed(3)} kN/m¬≤</span><br>` +
                    `Fall 2 (snoficka): Œº<sub>2</sub> ¬∑ s<sub>k</sub> = ${mu2.toFixed(3)} ¬∑ ${v.sk.toFixed(1)} = <span class="highlight">${s2.toFixed(3)} kN/m¬≤</span>`;
            }

            drawRoof(v, mu1, mu2);
            drawMuChart(v.alpha);
        }

        function drawRoof(v, mu1, mu2) {
            const canvas = document.getElementById('roofCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const cx = canvas.width / 2;
            const baseY = canvas.height - 60;
            const roofW = canvas.width * 0.6;
            const angleRad = v.alpha * Math.PI / 180;

            if (roofType === 'pulpet') {
                const leftX = cx - roofW / 2;
                const rightX = cx + roofW / 2;
                const rise = roofW * Math.tan(angleRad);
                const leftY = baseY - 80;
                const rightY = leftY - rise;

                // Wall
                ctx.fillStyle = colors.wall;
                ctx.fillRect(leftX - 5, leftY, 10, 80);
                ctx.fillRect(rightX - 5, rightY, 10, baseY - rightY);

                // Roof
                ctx.strokeStyle = colors.roof;
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.moveTo(leftX, leftY);
                ctx.lineTo(rightX, rightY);
                ctx.stroke();

                // Snow on roof
                const s = mu1 * v.ce * v.ct * v.sk;
                const snowThick = Math.min(s * 20, 40);
                const nx = Math.cos(angleRad);
                const ny = Math.sin(angleRad);

                ctx.fillStyle = colors.snow;
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.moveTo(leftX, leftY);
                ctx.lineTo(rightX, rightY);
                ctx.lineTo(rightX - ny * snowThick, rightY - nx * snowThick);
                ctx.lineTo(leftX - ny * snowThick, leftY - nx * snowThick);
                ctx.closePath();
                ctx.fill();
                ctx.globalAlpha = 1;

                // Snow arrows
                ctx.strokeStyle = colors.arrowColor;
                ctx.fillStyle = colors.arrowColor;
                ctx.lineWidth = 2;
                for (let i = 0; i <= 5; i++) {
                    const t = i / 5;
                    const ax = leftX + t * (rightX - leftX);
                    const ay = leftY + t * (rightY - leftY);
                    drawArrow(ctx, ax, ay - 50, ax, ay - 5);
                }

                // Label
                ctx.fillStyle = colors.accent;
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('s = ' + s.toFixed(2) + ' kN/m¬≤', cx, leftY - 60);
                ctx.fillText('Œº‚ÇÅ = ' + mu1.toFixed(2), cx, leftY - 78);

                // Angle indicator
                ctx.strokeStyle = colors.accent;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(leftX, leftY, 40, -Math.PI / 2, -Math.PI / 2 + angleRad, true);
                ctx.stroke();
                ctx.font = '12px sans-serif';
                ctx.fillText('Œ±=' + v.alpha + '¬∞', leftX + 50, leftY - 10);

            } else {
                // Saddle roof
                const leftX = cx - roofW / 2;
                const rightX = cx + roofW / 2;
                const rise = (roofW / 2) * Math.tan(angleRad);
                const baseRoofY = baseY - 80;
                const peakY = baseRoofY - rise;

                // Walls
                ctx.fillStyle = colors.wall;
                ctx.fillRect(leftX - 5, baseRoofY, 10, 80);
                ctx.fillRect(rightX - 5, baseRoofY, 10, 80);

                // Roof
                ctx.strokeStyle = colors.roof;
                ctx.lineWidth = 5;
                ctx.beginPath();
                ctx.moveTo(leftX, baseRoofY);
                ctx.lineTo(cx, peakY);
                ctx.lineTo(rightX, baseRoofY);
                ctx.stroke();

                // Snow (uniform - mu1)
                const s1 = mu1 * v.ce * v.ct * v.sk;
                const snowThick = Math.min(s1 * 20, 35);

                ctx.fillStyle = colors.snow;
                ctx.globalAlpha = 0.6;
                ctx.beginPath();
                ctx.moveTo(leftX, baseRoofY);
                ctx.lineTo(cx, peakY);
                ctx.lineTo(cx, peakY - snowThick);
                ctx.lineTo(leftX, baseRoofY - snowThick);
                ctx.closePath();
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(cx, peakY);
                ctx.lineTo(rightX, baseRoofY);
                ctx.lineTo(rightX, baseRoofY - snowThick);
                ctx.lineTo(cx, peakY - snowThick);
                ctx.closePath();
                ctx.fill();
                ctx.globalAlpha = 1;

                // Arrows
                ctx.strokeStyle = colors.arrowColor;
                ctx.fillStyle = colors.arrowColor;
                ctx.lineWidth = 2;
                for (let i = 0; i <= 4; i++) {
                    const t = i / 4;
                    const ax = leftX + t * (cx - leftX);
                    const ay = baseRoofY + t * (peakY - baseRoofY);
                    drawArrow(ctx, ax, ay - 45, ax, ay - 5);
                }
                for (let i = 0; i <= 4; i++) {
                    const t = i / 4;
                    const ax = cx + t * (rightX - cx);
                    const ay = peakY + t * (baseRoofY - peakY);
                    drawArrow(ctx, ax, ay - 45, ax, ay - 5);
                }

                // Labels
                ctx.fillStyle = colors.accent;
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('Œº‚ÇÅ = ' + mu1.toFixed(2), cx, peakY - 55);
                ctx.fillText('s = ' + s1.toFixed(2) + ' kN/m¬≤', cx, peakY - 38);

                // Angle
                ctx.strokeStyle = colors.accent;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(leftX, baseRoofY, 40, -Math.PI, -Math.PI + angleRad);
                ctx.stroke();
                ctx.font = '12px sans-serif';
                ctx.fillStyle = colors.accent;
                ctx.fillText('Œ±=' + v.alpha + '¬∞', leftX + 50, baseRoofY - 8);
            }

            // Ground
            ctx.fillStyle = colors.ground;
            ctx.fillRect(0, baseY, canvas.width, 3);
            ctx.fillStyle = colors.textMuted;
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Takl√§ngd: ' + v.roofLen + ' m', cx, baseY + 20);
        }

        function drawMuChart(alpha) {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const margin = { left: 60, right: 30, top: 30, bottom: 40 };
            const w = canvas.width - margin.left - margin.right;
            const h = canvas.height - margin.top - margin.bottom;

            // Title
            ctx.fillStyle = colors.accent;
            ctx.font = 'bold 14px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Formfaktorer Œº vs takvinkel Œ±', canvas.width / 2, 18);

            // Grid
            ctx.strokeStyle = colors.grid;
            ctx.lineWidth = 1;
            for (let i = 0; i <= 4; i++) {
                const y = margin.top + (i / 4) * h;
                ctx.beginPath(); ctx.moveTo(margin.left, y); ctx.lineTo(margin.left + w, y); ctx.stroke();
            }
            for (let a = 0; a <= 60; a += 15) {
                const x = margin.left + (a / 60) * w;
                ctx.beginPath(); ctx.moveTo(x, margin.top); ctx.lineTo(x, margin.top + h); ctx.stroke();
            }

            // Axes
            ctx.strokeStyle = colors.textMuted;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(margin.left, margin.top);
            ctx.lineTo(margin.left, margin.top + h);
            ctx.lineTo(margin.left + w, margin.top + h);
            ctx.stroke();

            // X labels
            ctx.fillStyle = colors.textMuted;
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'center';
            for (let a = 0; a <= 60; a += 15) {
                ctx.fillText(a + '¬∞', margin.left + (a / 60) * w, margin.top + h + 18);
            }

            // Y labels
            ctx.textAlign = 'right';
            for (let m = 0; m <= 1.0; m += 0.2) {
                const y = margin.top + h - (m / 1.0) * h;
                ctx.fillText(m.toFixed(1), margin.left - 8, y + 4);
            }

            // mu1 curve
            ctx.strokeStyle = colors.mu1Color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let a = 0; a <= 60; a += 1) {
                const x = margin.left + (a / 60) * w;
                const y = margin.top + h - (getMu1(a) / 1.0) * h;
                if (a === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // mu2 curve (saddle roof)
            if (roofType === 'sadel') {
                ctx.strokeStyle = colors.mu2Color;
                ctx.lineWidth = 3;
                ctx.setLineDash([6, 4]);
                ctx.beginPath();
                for (let a = 0; a <= 60; a += 1) {
                    const x = margin.left + (a / 60) * w;
                    const y = margin.top + h - (getMu2(a) / 1.0) * h;
                    if (a === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Current angle marker
            const curX = margin.left + (alpha / 60) * w;
            const curMu1Y = margin.top + h - (getMu1(alpha) / 1.0) * h;

            ctx.strokeStyle = colors.accent;
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            ctx.moveTo(curX, margin.top);
            ctx.lineTo(curX, margin.top + h);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.fillStyle = colors.mu1Color;
            ctx.beginPath();
            ctx.arc(curX, curMu1Y, 6, 0, Math.PI * 2);
            ctx.fill();
            ctx.font = 'bold 12px monospace';
            ctx.textAlign = 'left';
            ctx.fillText('Œº‚ÇÅ=' + getMu1(alpha).toFixed(2), curX + 10, curMu1Y - 5);

            if (roofType === 'sadel') {
                const curMu2Y = margin.top + h - (getMu2(alpha) / 1.0) * h;
                ctx.fillStyle = colors.mu2Color;
                ctx.beginPath();
                ctx.arc(curX, curMu2Y, 6, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillText('Œº‚ÇÇ=' + getMu2(alpha).toFixed(2), curX + 10, curMu2Y + 15);
            }

            // Legend
            ctx.font = '12px sans-serif';
            const legX = margin.left + w - 100;
            ctx.fillStyle = colors.mu1Color;
            ctx.fillRect(legX, margin.top + 5, 20, 3);
            ctx.fillText('Œº‚ÇÅ', legX + 25, margin.top + 10);
            if (roofType === 'sadel') {
                ctx.fillStyle = colors.mu2Color;
                ctx.fillRect(legX, margin.top + 20, 20, 3);
                ctx.fillText('Œº‚ÇÇ', legX + 25, margin.top + 25);
            }
        }

        function drawArrow(ctx, x1, y1, x2, y2) {
            const headLen = 7;
            const angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI / 6), y2 - headLen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI / 6), y2 - headLen * Math.sin(angle + Math.PI / 6));
            ctx.closePath(); ctx.fill();
        }

        function resizeCanvases() {
            const container = document.querySelector('.canvas-container');
            if (!container) return;
            const cw = container.clientWidth;
            document.getElementById('roofCanvas').width = cw;
            document.getElementById('chartCanvas').width = cw;
            update();
        }

        const savedTheme = localStorage.getItem('snowCalcTheme') || 'serious';
        setTheme(savedTheme);
        window.addEventListener('resize', resizeCanvases);
        resizeCanvases();
    </script>
</body>
</html>
