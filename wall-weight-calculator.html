<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√§gg Egentyngd Kalkylator</title>
    <link id="favicon" rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='20' width='15' height='70' fill='%238d6e63'/><rect x='35' y='20' width='30' height='70' fill='%23ffb74d'/><rect x='75' y='20' width='15' height='70' fill='%238d6e63'/><rect x='5' y='10' width='90' height='15' fill='%23a1887f'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Pacifico&family=Inter:wght@400;500;600&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style id="theme-styles">
        /* Theme styles will be injected here */
    </style>
    <style>
        /* Base styles that don't change with theme */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .theme-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-btn {
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group input[type="number"] {
            width: 80px;
            padding: 10px;
            font-size: 1em;
            text-align: right;
            font-weight: 600;
        }

        .input-group .unit-label {
            font-size: 0.9em;
            min-width: 50px;
        }

        input[type="range"] {
            flex: 1;
            height: 10px;
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
        }

        .canvas-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        canvas {
            border-radius: 20px;
            width: 100%;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .comparison-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
        }

        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 50px;
            border-radius: 25px 25px 10px 10px;
            transition: height 0.5s ease;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .view-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .section-divider {
            height: 2px;
            margin: 20px 0;
        }

        /* Floating decorations */
        .decoration {
            position: fixed;
            pointer-events: none;
            animation: float 3s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
        }

        @keyframes catBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .cat-decoration {
            animation: catBounce 2s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="theme-selector">
            <button class="theme-btn" data-theme="serious" onclick="setTheme('serious')">
                <span>üìê</span> Seri√∂s
            </button>
            <button class="theme-btn" data-theme="princess" onclick="setTheme('princess')">
                <span>üëë</span> Prinsessa
            </button>
            <button class="theme-btn" data-theme="cats" onclick="setTheme('cats')">
                <span>üê±</span> Katter
            </button>
        </div>

        <div class="theme-decoration"></div>
        <h1 id="main-title">V√§gg Egentyngd Kalkylator</h1>
        <p class="subtitle">Ber√§kna egentyngd f√∂r v√§ggkonstruktion med tr√§reglar och isolering</p>

        <div class="main-content">
            <div class="controls">
                <div class="example-note">
                    <strong>F√∂renklade v√§rden fr√•n anteckningar:</strong><br>
                    Tr√§: 5 kN/m¬≥, Isolering: 0.3 kN/m¬≥<br>
                    Regel: 45mm, c/c 600mm, Tjocklek: 190mm<br>
                    ‚Üí G<sub>k</sub> = 0.124 kN/m¬≤
                </div>

                <div class="section-header">
                    <h3>F√∂rval</h3>
                </div>
                <div class="preset-buttons">
                    <button class="preset-btn active" id="presetExample">Exempel (0.124)</button>
                    <button class="preset-btn" id="presetThin">Tunn v√§gg</button>
                    <button class="preset-btn" id="presetThick">Tjock v√§gg</button>
                    <button class="preset-btn" id="presetWoodOnly">Endast tr√§</button>
                </div>

                <div class="section-divider"></div>
                <div class="section-header">
                    <h3>Materialegenskaper</h3>
                </div>

                <div class="control-group">
                    <label>Densitet tr√§ (Œ≥<sub>tr√§</sub>) <span class="unit">[kN/m¬≥]</span></label>
                    <div class="input-group">
                        <input type="number" id="woodDensity" min="1" max="12" step="0.1" value="5">
                        <span class="unit-label">kN/m¬≥</span>
                        <input type="range" id="woodDensitySlider" min="1" max="12" step="0.1" value="5">
                    </div>
                </div>

                <div class="control-group">
                    <label>Densitet isolering (Œ≥<sub>iso</sub>) <span class="unit">[kN/m¬≥]</span></label>
                    <div class="input-group">
                        <input type="number" id="insulationDensity" min="0.05" max="2" step="0.05" value="0.3">
                        <span class="unit-label">kN/m¬≥</span>
                        <input type="range" id="insulationDensitySlider" min="0.05" max="2" step="0.05" value="0.3">
                    </div>
                </div>

                <div class="section-divider"></div>
                <div class="section-header">
                    <h3>Geometri</h3>
                </div>

                <div class="control-group">
                    <label>Regelbredd <span class="unit">[mm]</span></label>
                    <div class="input-group">
                        <input type="number" id="studWidth" min="20" max="100" step="1" value="45">
                        <span class="unit-label">mm</span>
                        <input type="range" id="studWidthSlider" min="20" max="100" step="1" value="45">
                    </div>
                </div>

                <div class="control-group">
                    <label>Centrumavst√•nd (c/c) <span class="unit">[mm]</span></label>
                    <div class="input-group">
                        <input type="number" id="studSpacing" min="200" max="1200" step="10" value="600">
                        <span class="unit-label">mm</span>
                        <input type="range" id="studSpacingSlider" min="200" max="1200" step="10" value="600">
                    </div>
                </div>

                <div class="control-group">
                    <label>V√§ggtjocklek <span class="unit">[mm]</span></label>
                    <div class="input-group">
                        <input type="number" id="wallThickness" min="50" max="400" step="1" value="190">
                        <span class="unit-label">mm</span>
                        <input type="range" id="wallThicknessSlider" min="50" max="400" step="1" value="190">
                    </div>
                </div>

                <div class="control-group">
                    <label>Antal fack att visa <span class="unit">[st]</span></label>
                    <div class="input-group">
                        <input type="number" id="numBays" min="1" max="6" step="1" value="3">
                        <span class="unit-label">st</span>
                        <input type="range" id="numBaysSlider" min="1" max="6" step="1" value="3">
                    </div>
                </div>

                <div class="results">
                    <h3>Resultat</h3>

                    <div class="result-row">
                        <span class="result-label">Andel tr√§:</span>
                        <span class="result-value" id="woodFraction">0.075</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Andel isolering:</span>
                        <span class="result-value" id="insulationFraction">0.925</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">G<sub>k,tr√§</sub>:</span>
                        <span class="result-value" id="woodWeight">0.071 kN/m¬≤</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">G<sub>k,iso</sub>:</span>
                        <span class="result-value" id="insulationWeight">0.053 kN/m¬≤</span>
                    </div>
                    <div class="result-row total-row">
                        <span class="result-label">G<sub>k,total</sub>:</span>
                        <span class="result-value total" id="totalWeight">0.124 kN/m¬≤</span>
                    </div>

                    <div class="formula-box">
                        <div>G<sub>k</sub> = Œ≥<sub>tr√§</sub> ¬∑ t ¬∑ A<sub>tr√§</sub> + Œ≥<sub>iso</sub> ¬∑ t ¬∑ A<sub>iso</sub></div>
                        <div style="margin-top: 8px;" id="formulaExpanded"></div>
                    </div>
                </div>
            </div>

            <div class="visualization">
                <div class="view-tabs">
                    <button class="tab-btn active" data-view="cross">Tv√§rsnitt</button>
                    <button class="tab-btn" data-view="front">Framifr√•n</button>
                    <button class="tab-btn" data-view="3d">3D-vy</button>
                </div>

                <div class="canvas-container">
                    <canvas id="mainCanvas" width="800" height="400"></canvas>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color wood-color"></div>
                        <span>Tr√§ (reglar)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color insulation-color"></div>
                        <span>Isolering</span>
                    </div>
                </div>

                <div class="comparison-chart">
                    <div class="bar-container">
                        <div class="bar-value" id="barWoodValue">0.071</div>
                        <div class="bar bar-wood" id="barWood" style="height: 50px;"></div>
                        <div class="bar-label">Tr√§<br>bidrag</div>
                    </div>
                    <div class="bar-container">
                        <div class="bar-value" id="barInsulationValue">0.053</div>
                        <div class="bar bar-insulation" id="barInsulation" style="height: 40px;"></div>
                        <div class="bar-label">Isolering<br>bidrag</div>
                    </div>
                    <div class="bar-container">
                        <div class="bar-value" id="barTotalValue">0.124</div>
                        <div class="bar bar-total" id="barTotal" style="height: 90px;"></div>
                        <div class="bar-label">Total<br>egentyngd</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme definitions
        const themes = {
            serious: {
                name: 'Seri√∂s',
                favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='20' width='15' height='70' fill='%238d6e63'/><rect x='35' y='20' width='30' height='70' fill='%23ffb74d'/><rect x='75' y='20' width='15' height='70' fill='%238d6e63'/><rect x='5' y='10' width='90' height='15' fill='%23a1887f'/></svg>",
                decorations: [],
                colors: {
                    wood: { main: '#8d6e63', light: '#a1887f', dark: '#6d4c41', grain: '#5d4037' },
                    insulation: { main: '#ffb74d', light: '#ffe0b2', dark: '#ff9800', pattern: '#f57c00' },
                    text: '#e0e0e0',
                    textMuted: '#9e9e9e',
                    accent: '#4fc3f7',
                    accentDark: '#0288d1',
                    background: '#1a1a2e',
                    surface: 'rgba(255,255,255,0.05)',
                    border: 'rgba(255,255,255,0.1)',
                    total: '#81c784'
                },
                css: `
                    body {
                        font-family: 'Inter', sans-serif;
                        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                        color: #e0e0e0;
                    }
                    h1 {
                        text-align: center;
                        margin-bottom: 10px;
                        color: #4fc3f7;
                        font-weight: 600;
                        font-size: 2em;
                    }
                    .subtitle {
                        text-align: center;
                        color: #9e9e9e;
                        margin-bottom: 30px;
                    }
                    .theme-btn {
                        background: rgba(255,255,255,0.1);
                        border: 1px solid rgba(255,255,255,0.2);
                        color: #aaa;
                    }
                    .theme-btn:hover, .theme-btn.active {
                        background: rgba(79,195,247,0.2);
                        border-color: #4fc3f7;
                        color: #4fc3f7;
                    }
                    .controls, .visualization {
                        background: rgba(255,255,255,0.05);
                        border-radius: 15px;
                        padding: 25px;
                        border: 1px solid rgba(255,255,255,0.1);
                    }
                    .control-group label { color: #4fc3f7; }
                    .unit, .unit-label { color: #888; }
                    input[type="range"] {
                        background: #333;
                    }
                    input[type="range"]::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        width: 20px;
                        height: 20px;
                        border-radius: 50%;
                        background: #4fc3f7;
                        cursor: pointer;
                        box-shadow: 0 0 10px rgba(79,195,247,0.5);
                    }
                    .input-group input[type="number"] {
                        background: rgba(0,0,0,0.3);
                        border: 1px solid rgba(255,255,255,0.2);
                        border-radius: 8px;
                        color: #fff;
                        font-family: 'Inter', sans-serif;
                    }
                    .input-group input[type="number"]:focus {
                        outline: none;
                        border-color: #4fc3f7;
                    }
                    .results {
                        background: rgba(0,0,0,0.3);
                        border-radius: 10px;
                        padding: 20px;
                        margin-top: 20px;
                    }
                    .results h3, .section-header h3 {
                        color: #4fc3f7;
                        margin-bottom: 15px;
                        border-bottom: 1px solid rgba(79,195,247,0.3);
                        padding-bottom: 10px;
                    }
                    .result-row { border-bottom: 1px solid rgba(255,255,255,0.05); }
                    .result-label { color: #aaa; }
                    .result-value { color: #4fc3f7; font-weight: 700; font-family: monospace; }
                    .result-value.total { color: #81c784; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 2px solid rgba(79,195,247,0.3); }
                    .formula-box {
                        background: rgba(79,195,247,0.1);
                        border: 1px solid rgba(79,195,247,0.3);
                        border-radius: 8px;
                        padding: 15px;
                        margin-top: 15px;
                        font-family: monospace;
                        font-size: 0.9em;
                        line-height: 1.8;
                    }
                    .formula-box .highlight { color: #81c784; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, rgba(79,195,247,0.3) 50%, transparent 100%); }
                    .example-note {
                        background: rgba(79,195,247,0.1);
                        border: 1px solid rgba(79,195,247,0.3);
                        border-radius: 8px;
                        padding: 12px;
                        margin-bottom: 20px;
                        font-size: 0.85em;
                        color: #4fc3f7;
                    }
                    .example-note strong { color: #81c784; }
                    .preset-btn, .tab-btn {
                        padding: 10px 16px;
                        background: rgba(255,255,255,0.05);
                        border: 1px solid rgba(255,255,255,0.1);
                        border-radius: 8px;
                        color: #aaa;
                        cursor: pointer;
                        font-family: 'Inter', sans-serif;
                        transition: all 0.3s;
                    }
                    .preset-btn:hover, .tab-btn:hover {
                        background: rgba(255,255,255,0.1);
                    }
                    .preset-btn.active, .tab-btn.active {
                        background: rgba(79,195,247,0.2);
                        border-color: #4fc3f7;
                        color: #4fc3f7;
                    }
                    canvas { background: #0d1421; border: 1px solid rgba(255,255,255,0.1); }
                    .legend-item { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }
                    .wood-color { background: #8d6e63; }
                    .insulation-color { background: #ffb74d; }
                    .comparison-chart { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); }
                    .bar-wood { background: linear-gradient(180deg, #a1887f 0%, #8d6e63 100%); }
                    .bar-insulation { background: linear-gradient(180deg, #ffe0b2 0%, #ffb74d 100%); }
                    .bar-total { background: linear-gradient(180deg, #81c784 0%, #66bb6a 100%); }
                    .bar-label { color: #aaa; font-size: 0.8em; }
                    .bar-value { color: #fff; font-family: monospace; }
                `
            },
            princess: {
                name: 'Prinsessa',
                favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üëë</text></svg>",
                decorations: ['‚ú®', 'üíñ', '‚≠ê', 'üå∏', 'üíï', '‚úø'],
                colors: {
                    wood: { main: '#c48a9f', light: '#dda0b8', dark: '#a87088', grain: '#9b6a7f' },
                    insulation: { main: '#f5d0e8', light: '#ffe0f5', dark: '#e8b8d8', pattern: '#dba8c8' },
                    text: '#5a4a6a',
                    textMuted: '#9b7aa9',
                    accent: '#d4699e',
                    accentDark: '#c46a9e',
                    background: '#ffeef8',
                    surface: 'rgba(255,255,255,0.9)',
                    border: '#f5c6e0',
                    total: '#9b59b6'
                },
                css: `
                    body {
                        font-family: 'Quicksand', sans-serif;
                        background: linear-gradient(135deg, #ffeef8 0%, #f8e1f4 30%, #e8d5f9 70%, #dcd0ff 100%);
                        color: #5a4a6a;
                    }
                    h1 {
                        text-align: center;
                        margin-bottom: 10px;
                        color: #d4699e;
                        font-family: 'Pacifico', cursive;
                        font-size: 2.5em;
                        text-shadow: 2px 2px 4px rgba(212, 105, 158, 0.3);
                    }
                    .subtitle {
                        text-align: center;
                        color: #9b7aa9;
                        margin-bottom: 30px;
                        font-weight: 500;
                    }
                    .theme-btn {
                        background: linear-gradient(145deg, #fff 0%, #fff5fa 100%);
                        border: 2px solid #f5c6e0;
                        color: #b87a9e;
                    }
                    .theme-btn:hover, .theme-btn.active {
                        background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%);
                        border-color: #d46a9e;
                        color: #fff;
                    }
                    .controls {
                        background: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(255,240,250,0.9) 100%);
                        border-radius: 25px;
                        padding: 25px;
                        border: 3px solid #f5c6e0;
                        box-shadow: 0 10px 40px rgba(212, 105, 158, 0.2);
                    }
                    .visualization {
                        background: linear-gradient(145deg, rgba(255,255,255,0.9) 0%, rgba(248,240,255,0.9) 100%);
                        border-radius: 25px;
                        padding: 25px;
                        border: 3px solid #e0c6f5;
                        box-shadow: 0 10px 40px rgba(180, 130, 200, 0.2);
                    }
                    .control-group label { color: #c46a9e; }
                    .unit, .unit-label { color: #b89ac4; }
                    input[type="range"] {
                        background: linear-gradient(90deg, #ffd6eb 0%, #e8c6f5 100%);
                        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
                    }
                    input[type="range"]::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%);
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(212, 105, 158, 0.4);
                        border: 3px solid #fff;
                    }
                    .input-group input[type="number"] {
                        background: linear-gradient(145deg, #fff 0%, #fff8fc 100%);
                        border: 2px solid #f5c6e0;
                        border-radius: 15px;
                        color: #8b6a9e;
                        font-family: 'Quicksand', sans-serif;
                    }
                    .input-group input[type="number"]:focus {
                        outline: none;
                        border-color: #d46a9e;
                        box-shadow: 0 0 15px rgba(212, 105, 158, 0.3);
                    }
                    .results {
                        background: linear-gradient(145deg, #fff0f7 0%, #f8e8ff 100%);
                        border-radius: 20px;
                        padding: 20px;
                        margin-top: 20px;
                        border: 2px solid #f5d0e8;
                    }
                    .results h3, .section-header h3 {
                        color: #c46a9e;
                        margin-bottom: 15px;
                        border-bottom: 2px dashed #f5c6e0;
                        padding-bottom: 10px;
                        font-family: 'Pacifico', cursive;
                    }
                    .result-row { border-bottom: 1px dashed #f0d6eb; }
                    .result-label { color: #9b7aa9; }
                    .result-value { color: #c46a9e; font-weight: 700; }
                    .result-value.total { color: #9b59b6; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 2px dashed #e8b8d8; }
                    .formula-box {
                        background: linear-gradient(145deg, #fff5fa 0%, #f0e8ff 100%);
                        border: 2px dashed #dbb8e8;
                        border-radius: 15px;
                        padding: 15px;
                        margin-top: 15px;
                        font-size: 0.9em;
                        line-height: 1.8;
                    }
                    .formula-box .highlight { color: #9b59b6; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, #f5c6e0 50%, transparent 100%); }
                    .example-note {
                        background: linear-gradient(145deg, #fff0f7 0%, #ffe8f5 100%);
                        border: 2px dashed #f5a8c8;
                        border-radius: 20px;
                        padding: 15px;
                        margin-bottom: 20px;
                        font-size: 0.85em;
                        color: #b87a9e;
                    }
                    .example-note strong { color: #d46a9e; }
                    .preset-btn, .tab-btn {
                        padding: 12px 20px;
                        background: linear-gradient(145deg, #fff 0%, #fff5fa 100%);
                        border: 2px solid #f5c6e0;
                        border-radius: 25px;
                        color: #b87a9e;
                        cursor: pointer;
                        font-family: 'Quicksand', sans-serif;
                        font-weight: 600;
                        transition: all 0.3s;
                    }
                    .preset-btn:hover, .tab-btn:hover {
                        background: linear-gradient(145deg, #fff5fa 0%, #ffe8f5 100%);
                        transform: translateY(-2px);
                    }
                    .preset-btn.active, .tab-btn.active {
                        background: linear-gradient(145deg, #ff9ecb 0%, #d46a9e 100%);
                        border-color: #d46a9e;
                        color: #fff;
                        box-shadow: 0 5px 20px rgba(212, 105, 158, 0.4);
                    }
                    canvas { background: linear-gradient(180deg, #fff5fa 0%, #f8f0ff 100%); border: 2px solid #f0d6eb; }
                    .legend-item { background: rgba(255,255,255,0.7); border: 2px solid #f5d0e8; }
                    .wood-color { background: linear-gradient(145deg, #dda0b8 0%, #c48a9f 100%); }
                    .insulation-color { background: linear-gradient(145deg, #f5d0e8 0%, #e8b8d8 100%); }
                    .comparison-chart { background: linear-gradient(180deg, #fff8fc 0%, #f8f0ff 100%); border: 2px solid #f5d0e8; }
                    .bar-wood { background: linear-gradient(180deg, #dda0b8 0%, #c48a9f 100%); }
                    .bar-insulation { background: linear-gradient(180deg, #f5d0e8 0%, #e8b8d8 100%); }
                    .bar-total { background: linear-gradient(180deg, #c9a0dc 0%, #9b59b6 100%); }
                    .bar-label { color: #9b7aa9; font-weight: 600; font-size: 0.8em; }
                    .bar-value { color: #8b6a9e; font-weight: 700; }
                `
            },
            cats: {
                name: 'Katter',
                favicon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='80' font-size='80'>üê±</text></svg>",
                decorations: ['üê±', 'üêæ', 'üêü', 'üß∂', 'üò∫', 'üêà'],
                colors: {
                    wood: { main: '#ff9966', light: '#ffb088', dark: '#e07840', grain: '#cc6633' },
                    insulation: { main: '#b8e0d2', light: '#d4f0e7', dark: '#95c9b8', pattern: '#7eb8a5' },
                    text: '#4a4a4a',
                    textMuted: '#777',
                    accent: '#ff7744',
                    accentDark: '#e05500',
                    background: '#fff8f0',
                    surface: 'rgba(255,255,255,0.95)',
                    border: '#ffd4b8',
                    total: '#66bb6a'
                },
                css: `
                    body {
                        font-family: 'Comic Neue', cursive;
                        background: linear-gradient(135deg, #fff8f0 0%, #fff0e6 30%, #ffe8d6 70%, #ffeee0 100%);
                        color: #4a4a4a;
                    }
                    h1 {
                        text-align: center;
                        margin-bottom: 10px;
                        color: #ff7744;
                        font-size: 2.3em;
                        font-weight: 700;
                    }
                    h1::before { content: 'üò∫ '; }
                    h1::after { content: ' üò∫'; }
                    .subtitle {
                        text-align: center;
                        color: #888;
                        margin-bottom: 30px;
                    }
                    .subtitle::before { content: 'üêæ '; }
                    .subtitle::after { content: ' üêæ'; }
                    .theme-btn {
                        background: linear-gradient(145deg, #fff 0%, #fff8f0 100%);
                        border: 2px solid #ffd4b8;
                        color: #ff9966;
                    }
                    .theme-btn:hover, .theme-btn.active {
                        background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%);
                        border-color: #ff7744;
                        color: #fff;
                    }
                    .controls {
                        background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(255,248,240,0.95) 100%);
                        border-radius: 25px;
                        padding: 25px;
                        border: 3px solid #ffd4b8;
                        box-shadow: 0 10px 40px rgba(255, 150, 100, 0.15);
                    }
                    .visualization {
                        background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(240,255,248,0.95) 100%);
                        border-radius: 25px;
                        padding: 25px;
                        border: 3px solid #b8e0d2;
                        box-shadow: 0 10px 40px rgba(100, 180, 150, 0.15);
                    }
                    .control-group label { color: #ff7744; font-weight: 700; }
                    .unit, .unit-label { color: #aaa; }
                    input[type="range"] {
                        background: linear-gradient(90deg, #ffd4b8 0%, #b8e0d2 100%);
                        box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
                    }
                    input[type="range"]::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        width: 28px;
                        height: 28px;
                        border-radius: 50%;
                        background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%);
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(255, 120, 70, 0.4);
                        border: 3px solid #fff;
                    }
                    .input-group input[type="number"] {
                        background: #fff;
                        border: 2px solid #ffd4b8;
                        border-radius: 15px;
                        color: #666;
                        font-family: 'Comic Neue', cursive;
                    }
                    .input-group input[type="number"]:focus {
                        outline: none;
                        border-color: #ff7744;
                        box-shadow: 0 0 15px rgba(255, 120, 70, 0.3);
                    }
                    .results {
                        background: linear-gradient(145deg, #fff8f0 0%, #f0fff8 100%);
                        border-radius: 20px;
                        padding: 20px;
                        margin-top: 20px;
                        border: 2px solid #ffd4b8;
                    }
                    .results h3 {
                        color: #ff7744;
                        margin-bottom: 15px;
                        border-bottom: 3px dotted #ffd4b8;
                        padding-bottom: 10px;
                    }
                    .results h3::before { content: 'üê± '; }
                    .section-header h3 {
                        color: #ff7744;
                        margin-bottom: 15px;
                    }
                    .section-header h3::after { content: ' üêæ'; }
                    .result-row { border-bottom: 2px dotted #ffe8d6; }
                    .result-label { color: #888; }
                    .result-value { color: #ff7744; font-weight: 700; }
                    .result-value.total { color: #66bb6a; font-size: 1.2em; }
                    .total-row { margin-top: 10px; padding-top: 15px; border-top: 3px dotted #b8e0d2; }
                    .formula-box {
                        background: linear-gradient(145deg, #fff8f0 0%, #f0fff8 100%);
                        border: 3px dotted #ffd4b8;
                        border-radius: 15px;
                        padding: 15px;
                        margin-top: 15px;
                        font-size: 0.9em;
                        line-height: 1.8;
                    }
                    .formula-box .highlight { color: #66bb6a; font-weight: 700; }
                    .section-divider { background: linear-gradient(90deg, transparent 0%, #ffd4b8 30%, #b8e0d2 70%, transparent 100%); }
                    .example-note {
                        background: linear-gradient(145deg, #fff8f0 0%, #fffaf5 100%);
                        border: 3px dotted #ffb088;
                        border-radius: 20px;
                        padding: 15px;
                        margin-bottom: 20px;
                        font-size: 0.85em;
                        color: #888;
                    }
                    .example-note::before { content: 'üêü '; }
                    .example-note strong { color: #ff7744; }
                    .preset-btn, .tab-btn {
                        padding: 12px 20px;
                        background: linear-gradient(145deg, #fff 0%, #fff8f0 100%);
                        border: 2px solid #ffd4b8;
                        border-radius: 25px;
                        color: #ff9966;
                        cursor: pointer;
                        font-family: 'Comic Neue', cursive;
                        font-weight: 700;
                        transition: all 0.3s;
                    }
                    .preset-btn:hover, .tab-btn:hover {
                        background: linear-gradient(145deg, #fff8f0 0%, #ffefe0 100%);
                        transform: translateY(-2px) rotate(-1deg);
                    }
                    .preset-btn.active, .tab-btn.active {
                        background: linear-gradient(145deg, #ffb088 0%, #ff7744 100%);
                        border-color: #ff7744;
                        color: #fff;
                        box-shadow: 0 5px 20px rgba(255, 120, 70, 0.4);
                    }
                    canvas { background: linear-gradient(180deg, #fffaf5 0%, #f5fff8 100%); border: 3px solid #ffd4b8; }
                    .legend-item { background: rgba(255,255,255,0.8); border: 2px solid #ffd4b8; }
                    .wood-color { background: linear-gradient(145deg, #ffb088 0%, #ff9966 100%); }
                    .insulation-color { background: linear-gradient(145deg, #d4f0e7 0%, #b8e0d2 100%); }
                    .comparison-chart { background: linear-gradient(180deg, #fffaf5 0%, #f5fff8 100%); border: 3px solid #ffd4b8; }
                    .bar-wood { background: linear-gradient(180deg, #ffb088 0%, #ff9966 100%); }
                    .bar-insulation { background: linear-gradient(180deg, #d4f0e7 0%, #b8e0d2 100%); }
                    .bar-total { background: linear-gradient(180deg, #a5d6a7 0%, #66bb6a 100%); }
                    .bar-label { color: #888; font-weight: 700; font-size: 0.8em; }
                    .bar-value { color: #666; font-weight: 700; }
                    .decoration { animation-name: catBounce; }
                `
            }
        };

        let currentTheme = 'serious';
        let colors = themes.serious.colors;

        // Theme switching
        function setTheme(themeName) {
            currentTheme = themeName;
            const theme = themes[themeName];
            colors = theme.colors;

            // Update favicon
            document.getElementById('favicon').href = theme.favicon;

            // Update CSS
            document.getElementById('theme-styles').textContent = theme.css;

            // Update theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === themeName);
            });

            // Clear existing decorations
            document.querySelectorAll('.decoration').forEach(el => el.remove());

            // Add new decorations
            if (theme.decorations.length > 0) {
                for (let i = 0; i < 12; i++) {
                    const dec = document.createElement('div');
                    dec.className = 'decoration';
                    if (themeName === 'cats') dec.classList.add('cat-decoration');
                    dec.textContent = theme.decorations[Math.floor(Math.random() * theme.decorations.length)];
                    dec.style.left = Math.random() * 100 + 'vw';
                    dec.style.top = Math.random() * 100 + 'vh';
                    dec.style.animationDelay = Math.random() * 3 + 's';
                    dec.style.fontSize = (Math.random() * 15 + 12) + 'px';
                    document.body.appendChild(dec);
                }
            }

            // Store preference
            localStorage.setItem('wallCalcTheme', themeName);

            // Redraw canvas
            draw();
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('wallCalcTheme') || 'serious';
        setTheme(savedTheme);

        // Canvas and controls setup
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');

        const inputPairs = {
            woodDensity: { num: document.getElementById('woodDensity'), slider: document.getElementById('woodDensitySlider') },
            insulationDensity: { num: document.getElementById('insulationDensity'), slider: document.getElementById('insulationDensitySlider') },
            studWidth: { num: document.getElementById('studWidth'), slider: document.getElementById('studWidthSlider') },
            studSpacing: { num: document.getElementById('studSpacing'), slider: document.getElementById('studSpacingSlider') },
            wallThickness: { num: document.getElementById('wallThickness'), slider: document.getElementById('wallThicknessSlider') },
            numBays: { num: document.getElementById('numBays'), slider: document.getElementById('numBaysSlider') }
        };

        const displays = {
            woodFraction: document.getElementById('woodFraction'),
            insulationFraction: document.getElementById('insulationFraction'),
            woodWeight: document.getElementById('woodWeight'),
            insulationWeight: document.getElementById('insulationWeight'),
            totalWeight: document.getElementById('totalWeight'),
            formulaExpanded: document.getElementById('formulaExpanded')
        };

        const presets = {
            presetExample: { woodDensity: 5, insulationDensity: 0.3, studWidth: 45, studSpacing: 600, wallThickness: 190, numBays: 3 },
            presetThin: { woodDensity: 5, insulationDensity: 0.3, studWidth: 45, studSpacing: 600, wallThickness: 95, numBays: 3 },
            presetThick: { woodDensity: 5, insulationDensity: 0.3, studWidth: 45, studSpacing: 600, wallThickness: 220, numBays: 3 },
            presetWoodOnly: { woodDensity: 5, insulationDensity: 0.3, studWidth: 45, studSpacing: 45, wallThickness: 220, numBays: 3 }
        };

        let currentView = 'cross';

        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentView = btn.dataset.view;
                draw();
            });
        });

        // Preset buttons
        Object.keys(presets).forEach(presetId => {
            document.getElementById(presetId).addEventListener('click', () => {
                const preset = presets[presetId];
                Object.keys(preset).forEach(key => {
                    if (inputPairs[key]) {
                        inputPairs[key].num.value = preset[key];
                        inputPairs[key].slider.value = preset[key];
                    }
                });
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                document.getElementById(presetId).classList.add('active');
                update();
            });
        });

        // Sync inputs with sliders
        Object.keys(inputPairs).forEach(key => {
            const pair = inputPairs[key];
            pair.num.addEventListener('input', () => {
                pair.slider.value = pair.num.value;
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                update();
            });
            pair.slider.addEventListener('input', () => {
                pair.num.value = pair.slider.value;
                document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                update();
            });
        });

        function getValues() {
            return {
                woodDensity: parseFloat(inputPairs.woodDensity.num.value),
                insulationDensity: parseFloat(inputPairs.insulationDensity.num.value),
                studWidth: parseFloat(inputPairs.studWidth.num.value),
                studSpacing: parseFloat(inputPairs.studSpacing.num.value),
                wallThickness: parseFloat(inputPairs.wallThickness.num.value),
                numBays: parseInt(inputPairs.numBays.num.value)
            };
        }

        function update() {
            const v = getValues();
            const studWidthM = v.studWidth / 1000;
            const studSpacingM = v.studSpacing / 1000;
            const wallThicknessM = v.wallThickness / 1000;

            const woodFraction = studWidthM / studSpacingM;
            const insulationFraction = 1 - woodFraction;

            const woodWeight = v.woodDensity * wallThicknessM * woodFraction;
            const insulationWeight = v.insulationDensity * wallThicknessM * insulationFraction;
            const totalWeight = woodWeight + insulationWeight;

            displays.woodFraction.textContent = woodFraction.toFixed(3);
            displays.insulationFraction.textContent = insulationFraction.toFixed(3);
            displays.woodWeight.textContent = woodWeight.toFixed(3) + ' kN/m¬≤';
            displays.insulationWeight.textContent = insulationWeight.toFixed(3) + ' kN/m¬≤';
            displays.totalWeight.textContent = totalWeight.toFixed(3) + ' kN/m¬≤';

            displays.formulaExpanded.innerHTML =
                `G<sub>k</sub> = ${v.woodDensity} ¬∑ ${wallThicknessM.toFixed(3)} ¬∑ ${woodFraction.toFixed(3)} + ${v.insulationDensity} ¬∑ ${wallThicknessM.toFixed(3)} ¬∑ ${insulationFraction.toFixed(3)}<br>` +
                `G<sub>k</sub> = ${woodWeight.toFixed(3)} + ${insulationWeight.toFixed(3)}<br>` +
                `<span class="highlight">G<sub>k</sub> = ${totalWeight.toFixed(3)} kN/m¬≤</span>`;

            const maxHeight = 150;
            const maxWeight = Math.max(totalWeight * 1.2, 0.2);

            document.getElementById('barWood').style.height = (woodWeight / maxWeight * maxHeight) + 'px';
            document.getElementById('barInsulation').style.height = (insulationWeight / maxWeight * maxHeight) + 'px';
            document.getElementById('barTotal').style.height = (totalWeight / maxWeight * maxHeight) + 'px';

            document.getElementById('barWoodValue').textContent = woodWeight.toFixed(3);
            document.getElementById('barInsulationValue').textContent = insulationWeight.toFixed(3);
            document.getElementById('barTotalValue').textContent = totalWeight.toFixed(3);

            draw();
        }

        function draw() {
            const v = getValues();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (currentView === 'cross') {
                drawCrossSection(v.studWidth, v.studSpacing, v.wallThickness, v.numBays);
            } else if (currentView === 'front') {
                drawFrontView(v.studWidth, v.studSpacing, v.wallThickness, v.numBays);
            } else {
                draw3DView(v.studWidth, v.studSpacing, v.wallThickness, v.numBays);
            }
        }

        function getViewTitle(view) {
            const titles = {
                cross: { serious: 'Tv√§rsnitt (ovanifr√•n)', princess: '‚ú® Tv√§rsnitt (ovanifr√•n) ‚ú®', cats: 'üê± Tv√§rsnitt (ovanifr√•n) üê±' },
                front: { serious: 'Framifr√•n (elevation)', princess: 'üíñ Framifr√•n (elevation) üíñ', cats: 'üò∫ Framifr√•n (elevation) üò∫' },
                '3d': { serious: '3D Isometrisk vy', princess: 'üå∏ 3D Isometrisk vy üå∏', cats: 'üêæ 3D Isometrisk vy üêæ' }
            };
            return titles[view][currentTheme];
        }

        function drawCrossSection(studWidth, studSpacing, wallThickness, numBays) {
            const totalWidth = studSpacing * numBays + studWidth;
            const scale = Math.min((canvas.width - 100) / totalWidth, (canvas.height - 120) / wallThickness);
            const startX = (canvas.width - totalWidth * scale) / 2;
            const startY = (canvas.height - wallThickness * scale) / 2;

            ctx.fillStyle = colors.accent;
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(getViewTitle('cross'), canvas.width / 2, 25);

            for (let i = 0; i <= numBays; i++) {
                const studX = startX + i * studSpacing * scale;

                if (i > 0) {
                    const insX = startX + (i - 1) * studSpacing * scale + studWidth * scale;
                    const insWidth = (studSpacing - studWidth) * scale;

                    const insGrad = ctx.createLinearGradient(insX, startY, insX, startY + wallThickness * scale);
                    insGrad.addColorStop(0, colors.insulation.light);
                    insGrad.addColorStop(1, colors.insulation.main);
                    ctx.fillStyle = insGrad;
                    ctx.fillRect(insX, startY, insWidth, wallThickness * scale);

                    ctx.fillStyle = colors.insulation.pattern;
                    ctx.font = '12px serif';
                    const pattern = currentTheme === 'princess' ? '‚ô°' : currentTheme === 'cats' ? 'üêæ' : '~';
                    for (let y = startY + 15; y < startY + wallThickness * scale - 10; y += 25) {
                        for (let x = insX + 15; x < insX + insWidth - 10; x += 30) {
                            ctx.fillText(pattern, x + (y % 50 === 15 ? 0 : 15), y);
                        }
                    }
                }

                const woodGrad = ctx.createLinearGradient(studX, startY, studX + studWidth * scale, startY);
                woodGrad.addColorStop(0, colors.wood.light);
                woodGrad.addColorStop(0.5, colors.wood.main);
                woodGrad.addColorStop(1, colors.wood.dark);
                ctx.fillStyle = woodGrad;
                ctx.fillRect(studX, startY, studWidth * scale, wallThickness * scale);

                ctx.strokeStyle = colors.wood.grain;
                ctx.lineWidth = 1;
                for (let y = startY + 5; y < startY + wallThickness * scale; y += 8) {
                    ctx.beginPath();
                    ctx.moveTo(studX + 2, y);
                    ctx.lineTo(studX + studWidth * scale - 2, y);
                    ctx.stroke();
                }
            }

            ctx.strokeStyle = colors.accent;
            ctx.fillStyle = colors.accent;
            ctx.lineWidth = 2;
            ctx.font = '12px sans-serif';

            const dimY1 = startY - 25;
            ctx.beginPath();
            ctx.moveTo(startX, dimY1);
            ctx.lineTo(startX, dimY1 + 10);
            ctx.moveTo(startX, dimY1 + 5);
            ctx.lineTo(startX + studWidth * scale, dimY1 + 5);
            ctx.moveTo(startX + studWidth * scale, dimY1);
            ctx.lineTo(startX + studWidth * scale, dimY1 + 10);
            ctx.stroke();
            ctx.textAlign = 'center';
            ctx.fillText(studWidth + ' mm', startX + studWidth * scale / 2, dimY1 - 5);

            const dimY2 = startY - 50;
            ctx.beginPath();
            ctx.moveTo(startX, dimY2);
            ctx.lineTo(startX, dimY2 + 10);
            ctx.moveTo(startX, dimY2 + 5);
            ctx.lineTo(startX + studSpacing * scale, dimY2 + 5);
            ctx.moveTo(startX + studSpacing * scale, dimY2);
            ctx.lineTo(startX + studSpacing * scale, dimY2 + 10);
            ctx.stroke();
            ctx.fillText('c/c ' + studSpacing + ' mm', startX + studSpacing * scale / 2, dimY2 - 5);

            const dimX = startX + totalWidth * scale + 20;
            ctx.beginPath();
            ctx.moveTo(dimX, startY);
            ctx.lineTo(dimX + 10, startY);
            ctx.moveTo(dimX + 5, startY);
            ctx.lineTo(dimX + 5, startY + wallThickness * scale);
            ctx.moveTo(dimX, startY + wallThickness * scale);
            ctx.lineTo(dimX + 10, startY + wallThickness * scale);
            ctx.stroke();
            ctx.save();
            ctx.translate(dimX + 25, startY + wallThickness * scale / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText(wallThickness + ' mm', 0, 0);
            ctx.restore();
        }

        function drawFrontView(studWidth, studSpacing, wallThickness, numBays) {
            const wallHeight = 300;
            const totalWidth = studSpacing * numBays + studWidth;
            const scale = Math.min((canvas.width - 100) / totalWidth, (canvas.height - 80) / wallHeight);
            const startX = (canvas.width - totalWidth * scale) / 2;
            const startY = (canvas.height - wallHeight * scale) / 2;

            ctx.fillStyle = colors.accent;
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(getViewTitle('front'), canvas.width / 2, 25);

            for (let i = 0; i <= numBays; i++) {
                const studX = startX + i * studSpacing * scale;

                if (i > 0) {
                    const insX = startX + (i - 1) * studSpacing * scale + studWidth * scale;
                    const insWidth = (studSpacing - studWidth) * scale;

                    const insGrad = ctx.createLinearGradient(insX, startY, insX + insWidth, startY);
                    insGrad.addColorStop(0, colors.insulation.light);
                    insGrad.addColorStop(1, colors.insulation.main);
                    ctx.fillStyle = insGrad;
                    ctx.fillRect(insX, startY, insWidth, wallHeight * scale);

                    ctx.strokeStyle = colors.insulation.pattern;
                    ctx.lineWidth = 1;
                    for (let d = -wallHeight * scale; d < insWidth; d += 25) {
                        ctx.beginPath();
                        ctx.moveTo(Math.max(insX, insX + d), Math.max(startY, startY - d));
                        ctx.lineTo(Math.min(insX + insWidth, insX + d + wallHeight * scale),
                                   Math.min(startY + wallHeight * scale, startY + wallHeight * scale - d));
                        ctx.stroke();
                    }
                }

                const woodGrad = ctx.createLinearGradient(studX, startY, studX + studWidth * scale, startY);
                woodGrad.addColorStop(0, colors.wood.light);
                woodGrad.addColorStop(0.5, colors.wood.main);
                woodGrad.addColorStop(1, colors.wood.dark);
                ctx.fillStyle = woodGrad;
                ctx.fillRect(studX, startY, studWidth * scale, wallHeight * scale);

                ctx.strokeStyle = colors.wood.grain;
                ctx.lineWidth = 1;
                for (let x = studX + 3; x < studX + studWidth * scale; x += 6) {
                    ctx.beginPath();
                    ctx.moveTo(x, startY + 5);
                    ctx.lineTo(x, startY + wallHeight * scale - 5);
                    ctx.stroke();
                }
            }

            const plateGrad = ctx.createLinearGradient(startX, 0, startX + totalWidth * scale, 0);
            plateGrad.addColorStop(0, colors.wood.light);
            plateGrad.addColorStop(1, colors.wood.main);
            ctx.fillStyle = plateGrad;
            ctx.fillRect(startX, startY - 15, totalWidth * scale, 15);
            ctx.fillRect(startX, startY + wallHeight * scale, totalWidth * scale, 15);

            ctx.strokeStyle = colors.accent;
            ctx.fillStyle = colors.accent;
            ctx.lineWidth = 2;
            ctx.font = '12px sans-serif';

            const dimY = startY + wallHeight * scale + 40;
            ctx.beginPath();
            ctx.moveTo(startX, dimY);
            ctx.lineTo(startX, dimY + 10);
            ctx.moveTo(startX, dimY + 5);
            ctx.lineTo(startX + studSpacing * scale, dimY + 5);
            ctx.moveTo(startX + studSpacing * scale, dimY);
            ctx.lineTo(startX + studSpacing * scale, dimY + 10);
            ctx.stroke();
            ctx.textAlign = 'center';
            ctx.fillText('c/c ' + studSpacing + ' mm', startX + studSpacing * scale / 2, dimY + 25);
        }

        function draw3DView(studWidth, studSpacing, wallThickness, numBays) {
            const wallHeight = 200;
            const depth = wallThickness;
            const totalWidth = studSpacing * numBays + studWidth;
            const scale = Math.min((canvas.width - 150) / (totalWidth + depth * 0.5),
                                   (canvas.height - 100) / (wallHeight + depth * 0.5));
            const startX = 80;
            const startY = 60;
            const isoX = 0.7;
            const isoY = 0.4;

            ctx.fillStyle = colors.accent;
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(getViewTitle('3d'), canvas.width / 2, 25);

            function toIso(x, y, z) {
                return {
                    x: startX + (x + z * isoX) * scale,
                    y: startY + (wallHeight - y + z * isoY) * scale
                };
            }

            for (let i = numBays; i >= 0; i--) {
                const studXPos = i * studSpacing;

                if (i < numBays) {
                    const insX = studXPos + studWidth;
                    const insWidth = studSpacing - studWidth;

                    ctx.fillStyle = colors.insulation.dark;
                    ctx.beginPath();
                    let p = toIso(insX, 0, depth);
                    ctx.moveTo(p.x, p.y);
                    p = toIso(insX + insWidth, 0, depth);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX + insWidth, wallHeight, depth);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX, wallHeight, depth);
                    ctx.lineTo(p.x, p.y);
                    ctx.closePath();
                    ctx.fill();

                    ctx.fillStyle = colors.insulation.light;
                    ctx.beginPath();
                    p = toIso(insX, wallHeight, 0);
                    ctx.moveTo(p.x, p.y);
                    p = toIso(insX + insWidth, wallHeight, 0);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX + insWidth, wallHeight, depth);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX, wallHeight, depth);
                    ctx.lineTo(p.x, p.y);
                    ctx.closePath();
                    ctx.fill();

                    ctx.fillStyle = colors.insulation.main;
                    ctx.beginPath();
                    p = toIso(insX, 0, 0);
                    ctx.moveTo(p.x, p.y);
                    p = toIso(insX + insWidth, 0, 0);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX + insWidth, wallHeight, 0);
                    ctx.lineTo(p.x, p.y);
                    p = toIso(insX, wallHeight, 0);
                    ctx.lineTo(p.x, p.y);
                    ctx.closePath();
                    ctx.fill();
                }

                ctx.fillStyle = colors.wood.dark;
                ctx.beginPath();
                let p = toIso(studXPos, 0, depth);
                ctx.moveTo(p.x, p.y);
                p = toIso(studXPos + studWidth, 0, depth);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, depth);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos, wallHeight, depth);
                ctx.lineTo(p.x, p.y);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = colors.wood.grain;
                ctx.beginPath();
                p = toIso(studXPos + studWidth, 0, 0);
                ctx.moveTo(p.x, p.y);
                p = toIso(studXPos + studWidth, 0, depth);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, depth);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, 0);
                ctx.lineTo(p.x, p.y);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = colors.wood.light;
                ctx.beginPath();
                p = toIso(studXPos, wallHeight, 0);
                ctx.moveTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, 0);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, depth);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos, wallHeight, depth);
                ctx.lineTo(p.x, p.y);
                ctx.closePath();
                ctx.fill();

                ctx.fillStyle = colors.wood.main;
                ctx.beginPath();
                p = toIso(studXPos, 0, 0);
                ctx.moveTo(p.x, p.y);
                p = toIso(studXPos + studWidth, 0, 0);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos + studWidth, wallHeight, 0);
                ctx.lineTo(p.x, p.y);
                p = toIso(studXPos, wallHeight, 0);
                ctx.lineTo(p.x, p.y);
                ctx.closePath();
                ctx.fill();

                ctx.strokeStyle = colors.wood.grain;
                ctx.lineWidth = 1;
                for (let y = 10; y < wallHeight; y += 15) {
                    ctx.beginPath();
                    p = toIso(studXPos + 3, y, 0);
                    ctx.moveTo(p.x, p.y);
                    p = toIso(studXPos + studWidth - 3, y, 0);
                    ctx.lineTo(p.x, p.y);
                    ctx.stroke();
                }
            }

            ctx.fillStyle = colors.accent;
            ctx.font = '11px sans-serif';

            let p1 = toIso(0, -30, 0);
            let p2 = toIso(studSpacing, -30, 0);
            ctx.strokeStyle = colors.accent;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.textAlign = 'center';
            ctx.fillText('c/c ' + studSpacing + ' mm', (p1.x + p2.x) / 2, (p1.y + p2.y) / 2 - 8);

            p1 = toIso(totalWidth + 20, 0, 0);
            p2 = toIso(totalWidth + 20, 0, depth);
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.stroke();
            ctx.fillText(wallThickness + ' mm', (p1.x + p2.x) / 2 + 30, (p1.y + p2.y) / 2);
        }

        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = 400;
            draw();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        update();
    </script>
</body>
</html>
